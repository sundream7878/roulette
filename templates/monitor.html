<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ëŒ“ê¸€ ëª¨ë‹ˆí„°ë§ (ë¡œì»¬ì „ìš©)</title>
    <style>
        body { font-family: sans-serif; padding: 20px; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        h1 { color: #333; }
        input[type="text"] { width: 100%; padding: 12px; margin-bottom: 10px; border: 2px solid #ddd; border-radius: 5px; font-size: 14px; }
        .button-group { display: flex; gap: 10px; margin-bottom: 20px; }
        button { padding: 12px 24px; cursor: pointer; border: none; border-radius: 5px; font-weight: bold; font-size: 14px; }
        .btn-primary { background: #28a745; color: white; flex: 1; }
        .btn-primary:hover { background: #218838; }
        .btn-secondary { background: #17a2b8; color: white; }
        .btn-secondary:hover { background: #138496; }
        .btn-danger { background: #dc3545; color: white; }
        .btn-danger:hover { background: #c82333; }
        #status { margin-top: 20px; padding: 15px; border: 1px solid #ddd; border-radius: 5px; background: #f8f9fa; }
        #participantList { list-style: none; padding: 0; margin-top: 20px; }
        #participantList li { padding: 10px; margin: 5px 0; background: #e9ecef; border-radius: 5px; }
        .stats { display: flex; gap: 20px; margin-top: 20px; }
        .stat-box { flex: 1; padding: 15px; background: #007bff; color: white; border-radius: 5px; text-align: center; }
        .stat-box h3 { margin: 0; font-size: 32px; }
        .stat-box p { margin: 5px 0 0 0; font-size: 14px; }
        label { display: flex; align-items: center; gap: 10px; margin: 10px 0; }
        input[type="checkbox"] { width: 20px; height: 20px; }
        input[type="number"] { width: 80px; padding: 5px; border: 2px solid #ddd; border-radius: 5px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¯ Naver ì¹´í˜ ëŒ“ê¸€ ëª¨ë‹ˆí„°ë§</h1>
        <p style="color: #666;">ë¡œì»¬ ì „ìš© í˜ì´ì§€ (ë°°í¬ ì œì™¸)</p>
        
        <input type="text" id="cafeUrl" placeholder="ë„¤ì´ë²„ ì¹´í˜ ê²Œì‹œê¸€ URLì„ ì…ë ¥í•˜ì„¸ìš”">
        
        <label>
            <input type="checkbox" id="autoRefresh">
            ì‹¤ì‹œê°„ ìë™ ê°±ì‹  (
            <input type="number" id="refreshInterval" value="30" min="10" max="300">
            ì´ˆë§ˆë‹¤)
        </label>
        
        <div class="button-group">
            <button class="btn-primary" onclick="startMonitoring()">ğŸ” ì°¸ê°€ì ìˆ˜ì§‘</button>
            <button class="btn-secondary" onclick="clearList()">ğŸ—‘ï¸ ëª©ë¡ ì´ˆê¸°í™”</button>
        </div>
        
        <div id="status">ìƒíƒœ: ëŒ€ê¸° ì¤‘...</div>
        
        <div class="stats">
            <div class="stat-box">
                <h3 id="participantCount">0</h3>
                <p>ì´ ì°¸ê°€ì</p>
            </div>
            <div class="stat-box" style="background: #28a745;">
                <h3 id="commentCount">0</h3>
                <p>ì´ ëŒ“ê¸€ ìˆ˜</p>
            </div>
        </div>
        
        <ul id="participantList"></ul>
    </div>

    <script>
        let autoRefreshTimer = null;
        let lastUrl = '';

        async function startMonitoring(isAuto = false) {
            const url = document.getElementById('cafeUrl').value;
            const statusDiv = document.getElementById('status');
            const listUl = document.getElementById('participantList');

            if (!url) {
                alert('URLì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            lastUrl = url;
            if (!isAuto) listUl.innerHTML = ''; // ìˆ˜ë™ ì‹¤í–‰ì‹œì—ë§Œ ëª©ë¡ ì´ˆê¸°í™”
            statusDiv.innerText = 'ëŒ“ê¸€ ìˆ˜ì§‘ ì¤‘...';
            
            try {
                const response = await fetch('/api/fetch_comments', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ url: url })
                });
                
                const result = await response.json();
                
                if (result.error) {
                    statusDiv.innerText = 'âŒ ì—ëŸ¬: ' + result.error;
                } else {
                    const now = new Date().toLocaleTimeString('ko-KR');
                    statusDiv.innerText = `âœ… ${result.message} (${now})`;
                    
                    // í†µê³„ ì—…ë°ì´íŠ¸
                    document.getElementById('participantCount').innerText = result.participants.length;
                    document.getElementById('commentCount').innerText = result.total_comments || 0;
                    
                    // ì°¸ê°€ì ëª©ë¡ ì—…ë°ì´íŠ¸
                    if (!isAuto) {
                        result.participants.forEach(p => {
                            const li = document.createElement('li');
                            li.innerText = p;
                            listUl.appendChild(li);
                        });
                    }
                }
            } catch (e) {
                statusDiv.innerText = 'âŒ í†µì‹  ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + e.message;
            }
        }

        function clearList() {
            document.getElementById('participantList').innerHTML = '';
            document.getElementById('participantCount').innerText = '0';
            document.getElementById('commentCount').innerText = '0';
            document.getElementById('status').innerText = 'ìƒíƒœ: ëª©ë¡ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.';
        }

        // ìë™ ê°±ì‹  ì²´í¬ë°•ìŠ¤ ì´ë²¤íŠ¸
        document.getElementById('autoRefresh').addEventListener('change', function(e) {
            if (e.target.checked) {
                if (!lastUrl) {
                    alert('ë¨¼ì € URLì„ ì…ë ¥í•˜ê³  ìˆ˜ì§‘ì„ ì‹œì‘í•´ì£¼ì„¸ìš”.');
                    e.target.checked = false;
                    return;
                }
                const interval = parseInt(document.getElementById('refreshInterval').value) * 1000;
                autoRefreshTimer = setInterval(() => startMonitoring(true), interval);
                document.getElementById('status').innerText = `ğŸ”„ ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§ í™œì„±í™” (${interval/1000}ì´ˆë§ˆë‹¤ ê°±ì‹ )`;
            } else {
                if (autoRefreshTimer) {
                    clearInterval(autoRefreshTimer);
                    autoRefreshTimer = null;
                    document.getElementById('status').innerText = 'â¸ï¸ ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§ ì¤‘ì§€';
                }
            }
        });
    </script>
</body>
</html>
